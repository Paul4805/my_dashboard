{% extends "dashboard.html" %}
{% block title %}Data Tab{% endblock %}

{% block head %}
<link rel="stylesheet" href="/static/css/data_tab.css">
{% endblock %}

{% block content %}

<h2>Connected Databases</h2>

{% if message %}
  <div class="alert" style="background-color: #e6f7ff; color: #005b99; padding: 12px; border-radius: 6px; margin-bottom: 20px;">
    {{ message }}
  </div>
{% endif %}

<!-- Top Bar: Search + Buttons -->
<div class="top-controls">
  <input type="text" placeholder="Search..." class="dashboard-search" />
  <div class="button-group">
    <button id="connectDatabase" class="new-data-btn">âž• Connect Database</button>
    <button id="refreshPreviewsBtn" class="new-data-btn">ðŸ”„ Refresh Previews</button>
    <button class="icon-btn">â‡…</button>
    <button class="icon-btn">â‰¡</button>
    <button class="icon-btn">â–¦</button>
  </div>
</div>

<!-- Modals -->
<div id="dbModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h2>Select Database Type</h2>
    <div class="db-options">
      <button class="db-option" data-type="PostgreSQL" onclick="openPostgresForm()">PostgreSQL</button>
      <button class="db-option" data-type="MySQL">MySQL</button>
      <button class="db-option" data-type="MSSQL">MSSQL</button>
      <button class="db-option" data-type="Oracle">Oracle</button>
    </div>
  </div>
</div>

<div id="postgresModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closePostgresForm()">&times;</span>
    <h3>Connect to PostgreSQL</h3>
    <form id="postgresForm" method="post" action="/dashboard/data">
      <input type="hidden" name="db_type" value="PostgreSQL">
      <label>Host:</label>
      <input type="text" name="host" required>
      <label>Port:</label>
      <input type="number" name="port" value="5432" required>
      <label>Database Name:</label>
      <input type="text" name="database" required>
      <label>Username:</label>
      <input type="text" name="user" required>
      <label>Password:</label>
      <input type="password" name="password" required>
      <label>SSL Mode:</label>
      <select name="sslmode">
        <option value="disable">Disable</option>
        <option value="require">Require</option>
        <option value="verify-ca">Verify CA</option>
        <option value="verify-full">Verify Full</option>
      </select>
      <button type="submit">Connect</button>
    </form>
  </div>
</div>

<!-- Database Previews -->
<!-- Replace your current preview-section with this -->
<div id="preview-section">
  <div id="loadingSpinner" class="spinner-overlay">
    <div class="spinner"></div>
    <span>Loading previews...</span>
  </div>
  <div id="previewContent" style="display: none;"></div>
</div>

{% endblock %}

{% block scripts %}
<script src="/static/js/modal.js"></script>
<script src="/static/js/load_previews.js"></script>
{% endblock %}
